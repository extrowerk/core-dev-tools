target=${PWD##*-}
target_cpu=${target#nto*}
nto_target=${PWD##*-}
srcdir=${PWD}/..
qnx_target_version=6.3.0

if [ $target_cpu = x86 ]; then
	target_cpu=i386
fi
tmpstring=`echo ${target_cpu}-nto-qnx${qnx_target_version}`
target=`${srcdir}/config.sub ${tmpstring}`

function hook_preconfigure {
	case ${SYSNAME} in
	nto)
		host_cpu=$(uname -p)

		case "${target}" in
		nto*)   basedir=/usr
			if [ ${host_cpu} = ${target_cpu} ]; then
				configure_opts="${configure_opts} --host=${target}"
			fi
			;;
		*)      basedir=/opt/QNXsdk/host/qnx6/x86/usr ;;
		esac
		;;
	solaris)
		host_cpu=$(uname -p)
		case ${host_cpu} in
        i[34567]86) host_cpu=x86 ;;
		esac
		basedir=/opt/QNXsdk/host/solaris/${host_cpu}/usr
		;;
	linux)
		host_cpu=$(uname -m)
		case ${host_cpu} in
        i[34567]86) host_cpu=x86 ;;
		esac
		basedir=/opt/QNXsdk/host/linux/${host_cpu}/usr
		;;
	win32)
		basedir=/cygdrive/c/QNXsdk/host/win32/x86/usr
		;;
	*)
		echo "Don't have config for ${SYSNAME}"
		exit 1
		;;
	esac
	configure_opts="${configure_opts} --target=${target}"
	configure_opts="${configure_opts} --prefix=${basedir}"
	configure_opts="${configure_opts} --exec-prefix=${basedir}"
	configure_opts="${configure_opts} --with-local-prefix=${basedir}"
	configure_opts="${configure_opts} --program-prefix=${target}-"
	# This setting of --includedir is so that the readline compiles don't
	# get things from the wrong place - we'd prefer not to have to say
	# anything at all and let the qcc/gcc get the system headers on their
	# own, but the only thing we can do is point it at a safe place.
	#configure_opts="${configure_opts} --includedir=."
	configure_opts="${configure_opts} --enable-gdbmi"
	configure_opts="${configure_opts} --enable-build-warnings=-Wall"
	configure_opts="${configure_opts} --disable-nls"
}

function hook_premake {
	export TERMCAP="-lncurses"
	strip_r_switch
}

function hook_postconfigure {
	if test ${target} = ntomips -a ${SYSNAME} = nto; then
		for i in Makefile sim/Makefile sim/igen/Makefile; do 
			cp $i $i.bak
			sed -e '/^CC_FOR_BUILD =/s/= .*$/= unset QNX_TARGET; \/usr\/bin\/cc/' <$i.bak >$i
			rm $i.bak
		done
	fi
}

function hook_pinfo {
	cd gdb
	gen_pinfo -e -ngdb ${target}-gdb usr/bin USE="%1>%C --help" LICE=GPL DESCRIPTION="GNU Debugger 5.2"
}
